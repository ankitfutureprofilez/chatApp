(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73275],{847096:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[teamSlug]/[project]/stores",function(){return r(178330)}])},464544:function(e,t,r){"use strict";r.d(t,{_:function(){return g}});var o=r(397458),n=r(603385),s=r.n(n),i=r(68839),a=r(9055),c=r(921690),l=r(466332),d=r(291033),u=r(171267),p=r.n(u);function g(e){var t;let{team:r,resource:n,title:u="Additional Permissions Required",customMessage:g,className:h}=e,x=(null==r?void 0:null===(t=r.membership)||void 0===t?void 0:t.role)??"",j=s()(x.replaceAll("_"," "));return(0,o.jsxs)(i.K,{align:"center",className:h??p().additionalPermissionsWrapper,gap:4,justify:"center",children:[(0,o.jsx)(a.x,{align:"center",weight:500,children:u}),(0,o.jsx)(a.x,{align:"center",as:"p",className:p().message,children:x?(0,o.jsxs)(o.Fragment,{children:["As a ",(0,o.jsx)(a.x,{as:"span",weight:500,children:j})," on the ",(0,o.jsx)(l.qE,{size:20,teamId:(null==r?void 0:r.id)??""}),(0,o.jsx)(a.x,{as:"span",weight:500,children:` ${(null==r?void 0:r.name)??""}`})," team, ",g||`you do not have permission to view ${n}.`]}):`You do not have permission to view ${n}.`}),(0,o.jsxs)(a.x,{align:"center",as:"p",className:p().link,color:"gray-900",children:["Learn more about"," ",(0,o.jsx)(c.r,{external:!0,href:"/docs/accounts/team-members-and-roles/access-roles",onClick:()=>{d.co.track(d.s6.PERMISSIONS_CLICKED_LEARN_MORE)},type:"highlight",children:"Roles and Permissions"})]})]})}},178330:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return X}});var o=r(397458),n=r(652983),s=r(446118),i=r(68839),a=r(9055),c=r(832191),l=r(977169),d=r(200850),u=r(921690),p=r(927628),g=r(464544),h=r(913891),x=r(921550),j=r(668909),y=r(14517),m=r(588875),f=r(307818),b=r(726281),C=r(879992),v=r(978702),S=r(761891),w=r(568841),_=r(135635),T=r(384157),k=r(425742),R=r(611309),N=r(281696),I=r.n(N),E=r(121930),K=r(660950),L=r(727312),z=r(161020),A=r(70495),D=r(118433),B=r(490235),O=r(80850),P=r(743133),$=r(798561),q=r(505134);function U(e){var t,r,s,c,l,d,u,p,g,h;let{storeStepState:x,onChangeStoreStepState:j,onClickOutside:y,project:m,limit:b,plan:v}=e,{pushToDetailPath:S}=(0,A.fH)({project:m}),w=(0,n.useCallback)(()=>{j({...x,step:"select"})},[j,x]),{updateCacheAfterConnect:_,updateCacheAfterCreate:T}=(0,f.i)(),k=(0,n.useCallback)(async()=>{await _(m),await S({id:x.storeId??"",path:"items",type:"edge-config"})},[m,S,x.storeId,_]),N=(0,n.useCallback)(async e=>{await T((0,C.K4)({edgeConfig:e,project:m.data})),j({...x,storeId:e.id,storeName:e.slug,step:"configure-env"})},[j,m.data,x,T]),I=(0,n.useCallback)(async()=>{await S({id:x.storeId??"",path:"guides",type:"redis"})},[S,x.storeId]),P=async()=>{await S({id:x.storeId??"",path:"guides",type:"blob"})},$=(0,n.useCallback)(async()=>{await S({id:x.storeId??"",path:"guides",type:"postgres"})},[S,x.storeId]);switch(x.step){case"create":if("edge-config"===x.storeType)return(0,o.jsx)(K.a,{active:!0,cancelLabel:"Go Back",createLabel:"Create & Continue",onClickOutside:w,onEdgeConfigCreated:N,projectName:null===(t=m.data)||void 0===t?void 0:t.name});if("redis"===x.storeType)return(0,o.jsx)(R.i,{active:!0,createLabel:"Create & Continue",onBack:()=>j({...x,step:"confirm-soc2"}),onRedisCreate:e=>{j({...x,storeId:e.id,storeName:e.name,step:"configure-env"})},projectName:null===(r=m.data)||void 0===r?void 0:r.name,projectRegion:null===(s=m.data)||void 0===s?void 0:s.serverlessFunctionRegion});if("postgres"===x.storeType)return(0,o.jsx)(B.E,{active:!0,createLabel:"Create & Continue",onBack:()=>j({...x,step:"confirm-soc2"}),onPostgresCreate:e=>{j({...x,storeId:e.id,storeName:e.name,step:"configure-env"})},projectName:null===(c=m.data)||void 0===c?void 0:c.name,projectRegion:null===(l=m.data)||void 0===l?void 0:l.serverlessFunctionRegion});if("blob"===x.storeType)return(0,o.jsx)(q.f,{active:!0,createLabel:"Create & Continue",onBack:w,onBlobCreated:e=>{j({...x,storeId:e.id,storeName:e.name,step:"configure-env"})},projectName:null===(d=m.data)||void 0===d?void 0:d.name});return null;case"configure-env":if("edge-config"===x.storeType)return(0,o.jsx)(L.U3,{edgeConfig:{id:x.storeId??"",slug:x.storeName??""},onClickOutside:y,onConnectionCreated:k,project:m.data,subtitle:(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:1.5,justify:"center",children:[(0,o.jsx)(a.x,{color:"gray-900",children:"Connect to"}),(0,o.jsx)(E.V,{size:"small",type:x.storeType,useColor:!0}),(0,o.jsx)(a.x,{color:"gray-1000",weight:500,children:x.storeName})]}),title:`Configure ${(null===(u=m.data)||void 0===u?void 0:u.name)??""}`});if("redis"===x.storeType)return(0,o.jsx)(z.Tb,{onClickOutside:y,onConnectionCreated:I,project:m.data,storeId:x.storeId??"",storeType:"redis",subtitle:(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:1.5,justify:"center",children:[(0,o.jsx)(a.x,{color:"gray-900",children:"Connect to"}),(0,o.jsx)(E.V,{size:"small",type:x.storeType,useColor:!0}),(0,o.jsx)(a.x,{color:"gray-1000",weight:500,children:x.storeName})]}),title:`Configure ${(null===(p=m.data)||void 0===p?void 0:p.name)??""}`});if("postgres"===x.storeType)return(0,o.jsx)(z.Tb,{onClickOutside:y,onConnectionCreated:$,project:m.data,storeId:x.storeId??"",storeType:"postgres",subtitle:(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:1.5,justify:"center",children:[(0,o.jsx)(a.x,{color:"gray-900",children:"Connect to"}),(0,o.jsx)(E.V,{size:"small",type:x.storeType,useColor:!0}),(0,o.jsx)(a.x,{color:"gray-1000",weight:500,children:x.storeName})]}),title:`Configure ${(null===(g=m.data)||void 0===g?void 0:g.name)??""}`});if("blob"===x.storeType)return(0,o.jsx)(z.Tb,{onClickOutside:y,onConnectionCreated:P,project:m.data,storeId:x.storeId??"",storeType:"blob",subtitle:(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:1.5,justify:"center",children:[(0,o.jsx)(a.x,{color:"gray-900",children:"Connect to"}),(0,o.jsx)(E.V,{size:"small",type:x.storeType,useColor:!0}),(0,o.jsx)(a.x,{color:"gray-1000",weight:500,children:x.storeName})]}),title:`Configure ${(null===(h=m.data)||void 0===h?void 0:h.name)??""}`});return null;case"confirm-soc2":if(!x.storeType)throw Error("The store type is undefined for the SOC2 step.");return(0,o.jsx)(D.Z,{onBack:w,onContinue:()=>j({...x,step:"create"}),storeType:x.storeType});case"limit-reached":return(0,o.jsx)(O.CreateStoreLimitReachedWarningStep,{limit:b,onBack:w,plan:v,storeType:x.storeType});default:return null}}function W(e){let{store:t,isDisabled:r}=e;switch(t.type){case"postgres":return(0,o.jsxs)(i.K,{className:I().connectStoreRadioLabel,gap:0,children:[(0,o.jsx)(a.x,{color:r?"gray-800":"gray-1000",lineHeight:24,size:14,truncate:!0,weight:600,children:t.name}),(0,o.jsx)(a.x,{color:r?"gray-800":"gray-900",children:$.eD.postgres})]});case"blob":return(0,o.jsxs)(i.K,{className:I().connectStoreRadioLabel,gap:0,children:[(0,o.jsx)(a.x,{color:r?"gray-800":"gray-1000",lineHeight:24,size:14,truncate:!0,weight:600,children:t.name}),(0,o.jsx)(a.x,{color:r?"gray-800":"gray-900",children:"Blob Store"})]});case"redis":return(0,o.jsxs)(i.K,{className:I().connectStoreRadioLabel,children:[(0,o.jsx)(a.x,{color:r?"gray-800":"gray-1000",lineHeight:24,size:14,truncate:!0,weight:600,children:t.name}),(0,o.jsx)(a.x,{color:r?"gray-800":"gray-900",children:$.eD.redis})]});case"edge-config":return(0,o.jsxs)(i.K,{children:[(0,o.jsx)(a.x,{color:r?"gray-800":"gray-1000",lineHeight:24,size:14,truncate:!0,weight:600,children:t.name}),(0,o.jsx)(a.x,{color:r?"gray-800":"gray-900",children:$.eD["edge-config"]})]});default:return null}}function M(e){let{store:t,isDisabled:r}=e,n=(0,b.R)(t.createdAt);return(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:4,justify:"space-between",children:[(0,o.jsxs)(i.K,{align:"center",className:I().connectStoreRadioLabel,direction:"row",flex:1,gap:3,style:{paddingLeft:4},children:[(0,o.jsx)(E.V,{size:"medium",type:t.type,useColor:!r}),(0,o.jsx)(W,{isDisabled:r,store:t})]}),(0,o.jsx)(a.x,{color:r?"gray-800":"gray-900",title:`Created at ${new Date(t.createdAt).toISOString()}`,children:r?"Already connected":`Created ${n}`})]})}function V(e){let{onChangeStoreStepState:t,storeStepState:r,project:s}=e,{data:a}=(0,f.i)(),c=(0,n.useRef)(null),{can:l,isLoading:d}=(0,S.ZP)(),u={postgres:l(S.aU.Update,S._z.Postgres),redis:l(S.aU.Update,S._z.Redis),"edge-config":l(S.aU.Update,S._z.EdgeConfig),blob:l(S.aU.Update,S._z.Blob)};return(0,n.useEffect)(()=>{setTimeout(()=>{if("connect"===r.tab){var e,t;null===(e=c.current)||void 0===e||e.focus(),null===(t=c.current)||void 0===t||t.select()}},0)},[r.tab]),(0,o.jsxs)(i.K,{align:"center",gap:6,children:[(0,o.jsx)(v.Z,{active:r.tab,items:[{name:"Select Existing",value:"connect",width:122,disabled:(null==a?void 0:a.stores.length)===0},{name:"Create New",value:"create",width:104}],onChange:e=>t({...r,tab:e})}),"connect"===r.tab?(0,o.jsx)(i.K,{className:I().connectStoreRadioWrapper,children:(null==a?void 0:a.stores)?(0,o.jsx)(j.Ee,{onChange:e=>{let o=a.stores.find(t=>t.id===e);t({...r,storeId:e,storeType:(null==o?void 0:o.type)??"redis",storeName:null==o?void 0:o.name})},value:r.storeId??"",children:(0,o.jsx)(i.K,{justify:"center",children:a.stores.map((e,t)=>{let r="redis"===e.type&&e.projectsMetadata.some(e=>{var t;return e.projectId===(null===(t=s.data)||void 0===t?void 0:t.id)})||d||!u[e.type];return(0,o.jsx)(w.Z,{disableTriggers:u[e.type],text:"You do not have permission to connect this database.",children:(0,o.jsx)(j.Ee.Item,{className:(0,y.W)(r?I().connectStoreRadioDisabled:I().connectStoreRadio),disabled:r,ref:0===t?c:null,value:e.id,children:(0,o.jsx)(M,{isDisabled:r,store:e})})},e.id)})})}):null}):(0,o.jsx)(k.I,{onChangeStore:e=>t({...r,storeType:e}),storeType:r.storeType})]})}let F={step:"select",tab:"create",storeType:void 0};function H(e){let{initialStoreType:t,...r}=e,{onClickOutside:s,active:c,onAnimationDone:l,project:d}=r,[u,p]=(0,n.useState)({...F,tab:r.hasStores?"connect":"create",storeType:t}),{team:g}=(0,_.t7)(),{hasRedisEnterprise:h}=(0,T.W0)();(0,n.useEffect)(()=>{!c&&(t&&t!==u.storeType||u.tab!==(r.hasStores?"connect":"create"))&&p({...u,storeType:t,tab:r.hasStores?"connect":"create"})},[t,r.hasStores,u,c]);let{limit:x,plan:j,isLimitReached:y}=(0,P.q)({storeType:u.storeType}),f=(0,n.useCallback)(()=>{p(F),s()},[s]);return(0,o.jsx)(m.Modal,{active:c,allowOverflow:!0,onAnimationDone:()=>{l(),f()},onClickOutside:()=>s(),width:540,children:"select"===u.step?(0,o.jsxs)("form",{onSubmit:e=>{let t;if(e.preventDefault(),"create"===u.tab){var r;t=y?"limit-reached":"edge-config"!==u.storeType&&"blob"!==u.storeType?"confirm-soc2":(null==g?void 0:null===(r=g.billing)||void 0===r?void 0:r.plan)!=="enterprise"||"blob"!==u.storeType||h?"create":"confirm-soc2"}else t="configure-env";p({...u,step:t})},children:[(0,o.jsx)(m.Body,{children:(0,o.jsxs)(i.K,{gap:6,children:[(0,o.jsxs)(i.K,{gap:2,children:[(0,o.jsx)(m.Title,{center:!0,children:"Connect a Database"}),(0,o.jsx)(m.Subtitle,{children:(0,o.jsx)(a.x,{align:"center",children:"Select an existing database or store, or create a new one."})})]}),(0,o.jsx)(V,{onChangeStoreStepState:p,project:d,storeStepState:u})]})}),(0,o.jsxs)(m.Actions,{children:[(0,o.jsx)(m.Action,{onClick:s,type:"secondary",children:"Cancel"}),(0,o.jsx)(m.Action,{buttonType:"submit",disabled:"create"===u.tab&&!u.storeType||"connect"===u.tab&&!u.storeId,children:"Continue"})]})]}):(0,o.jsx)(U,{limit:x,onChangeStoreStepState:p,onClickOutside:s,plan:j,project:d,storeStepState:u})})}var Z=r(557385),Y=r(822486),X=(0,h.V)(function(){let e=(0,s.useRouter)(),t=(0,p.PY)(e.query.project),{team:r,user:j,isLoading:y}=(0,Z.Z)(),{data:m,permissions:b}=(0,f.i)(),C=e.query.teamSlug,[v,S]=(0,x.b)("connect-store"),w=!t.isLoading&&!b.isLoading&&!y,[_,T]=(0,n.useState)(),[k,R]=(0,n.useState)(!!(null==m?void 0:m.stores.length));return(0,o.jsx)(Y.A2,{children:(0,o.jsxs)(d.Z,{buttons:(0,o.jsx)(c.z,{onClick:()=>{R(!!(null==m?void 0:m.stores.length)),setTimeout(()=>{v()},0)},type:"secondary",typeName:"button",children:"Connect Store"}),title:(0,o.jsxs)(i.K,{gap:4,children:[(0,o.jsx)(a.x,{as:"h1",size:32,weight:500,children:"Storage"}),(0,o.jsx)(i.K,{align:"center",direction:"row",gap:1,children:(0,o.jsxs)(a.x,{color:"gray-900",children:["Read and write directly to databases and stores connected to this project."," ",(0,o.jsx)(u.r,{href:r?`/dashboard/${r.slug}/stores`:"/dashboard/stores",type:"highlight",children:(0,o.jsxs)(i.K,{align:"center",direction:"row",gap:1,style:{display:"inline-flex"},children:[(0,o.jsx)("span",{children:"View All Databases"}),(0,o.jsx)(l.p,{size:16})]})})]})})]}),children:[(0,n.createElement)(H,{...S,hasStores:k,initialStoreType:_,key:S.key,project:t}),!b.list&&w?(0,o.jsx)(g._,{resource:"Storage",team:r}):(0,o.jsx)(h.D,{isReady:w,onEmptyActionClick:v,onShowCreateTab:e=>{R(!e)},onStoreFilterChanged:T,project:t,team:r,teamSlug:C,user:j})]})})})},977169:function(e,t,r){"use strict";r.d(t,{p:function(){return n}});var o=r(923390);let n=(0,o.H)('<circle cx="12" cy="12" r="10"/><path d="M12 16l4-4-4-4"/><path d="M8 12h8"/>','<circle cx="12" cy="12" r="10" fill="var(--geist-fill)"/><path d="M12 16l4-4-4-4" fill="none" stroke="var(--geist-stroke)"/><path d="M8 12h8" stroke="var(--geist-stroke)"/>')},171267:function(e){e.exports={additionalPermissionsWrapper:"additional-permissions-required_additionalPermissionsWrapper__FVwHY",message:"additional-permissions-required_message__IqhgE",link:"additional-permissions-required_link__iowP4"}},281696:function(e){e.exports={connectCreateSwitchButton:"store-modal-create-connect-for-project_connectCreateSwitchButton__a2F1d",connectCreateSwitchButtonActive:"store-modal-create-connect-for-project_connectCreateSwitchButtonActive__Ab64l",connectStoreRadio:"store-modal-create-connect-for-project_connectStoreRadio__6cpJR",connectStoreRadioDisabled:"store-modal-create-connect-for-project_connectStoreRadioDisabled__kFXCT",connectStoreRadioWrapper:"store-modal-create-connect-for-project_connectStoreRadioWrapper__73DtS",connectStoreRadioLabel:"store-modal-create-connect-for-project_connectStoreRadioLabel__xxSxm"}}},function(e){e.O(0,[4299,55555,23161,24148,98586,85394,38419,59085,49162,81797,21930,61020,81271,3739,9096,90515,49774,92888,40179],function(){return e(e.s=847096)}),_N_E=e.O()}]);