(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60521],{21050:function(e,n,t){"use strict";t.d(n,{Z:function(){return k}});var r=t(397458),a=t(977663),s=t(355344),i=t(652983),o=t(60326),l=t(68839),c=t(9055),d=t(588875),u=t(96808),h=t(684624),g=t(832191),m=t(245685),f=t(192734),b=t(362335);function v(e){let{deletePhone:n,error:t,isSendingCode:a,isVerifiedPhone:s,nextStep:i,onPhoneChange:o,phoneNumber:c}=e;return(0,r.jsx)("div",{id:"phone-number",children:(0,r.jsx)(f.Z,{description:"Enter a phone number to receive important service updates by SMS.",error:t.message,note:(0,r.jsx)(r.Fragment,{children:"A code will be sent to verify"}),onSave:i,saveDisabled:s,saveLoading:a,title:"Your Phone Number",children:(0,r.jsxs)(l.K,{direction:"row",gap:2,children:[(0,r.jsx)(b.Z,{autoHideDialCode:!0,disabled:s,format:!0,formatOnInit:!0,nationalMode:!1,onPhoneNumberChange:o,onSelectFlag:(e,n,t)=>{o(t,e,n)},style:{width:"300px",maxWidth:"100%"},telInputProps:{"data-error":t.message.length>0?"":void 0},useMobileFullscreenDropdown:!0,value:c}),c&&s?(0,r.jsx)(g.z,{"aria-label":"delete",onClick:()=>{n()},svgOnly:!0,type:"tertiary",children:(0,r.jsx)(m.r,{color:"var(--geist-error)"})}):null]})})})}var p=t(146344),y=t(466332),x=t(557385);function S(e){var n;let{error:t,isSendingCode:a,nextStep:s,onPhoneChange:o,phoneNumber:u}=e,g=(0,x.Z)(),[m,f]=(0,i.useState)(!0);return(0,r.jsx)(d.Modal,{active:m,allowOverflow:!0,onClickOutside:()=>f(!1),children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s()},children:[(0,r.jsx)(d.Body,{children:(0,r.jsx)(l.K,{align:"center",children:(0,r.jsxs)(l.K,{gap:5,justify:"center",style:{maxWidth:356},children:[(0,r.jsx)(c.x,{align:"center",as:"h3",size:24,style:{margin:0},weight:600,children:"SMS Notifications"}),(0,r.jsxs)(l.K,{align:"center",gap:4,children:[(0,r.jsx)(y.qE,{size:64,username:null===(n=g.user)||void 0===n?void 0:n.username}),(0,r.jsx)(c.x,{align:"center",as:"p",color:"gray-900",size:16,style:{margin:0},children:"Add a phone number to your account to enable notifications and service updates via SMS."}),(0,r.jsx)(b.Z,{format:!0,isModal:!0,nationalMode:!1,onPhoneNumberChange:o,onSelectFlag:(e,n,t)=>{o(t,e,n)},telInputProps:{"data-error":t.message?"":void 0},useMobileFullscreenDropdown:!0,value:u}),t.message?(0,r.jsx)(p.j,{"data-testid":(0,h.C)("login","error-message"),label:!1,children:t.message}):null]})]})})}),(0,r.jsxs)(d.Actions,{children:[(0,r.jsx)(d.Action,{onClick:()=>f(!1),type:"secondary",children:"Cancel"}),(0,r.jsx)(d.Action,{loading:a,onClick:()=>void s(),children:"Continue"})]})]})})}var C=t(306054);let j=e=>(0,r.jsxs)(r.Fragment,{children:["A 4 digit code has been sent to ",(0,r.jsx)("strong",{children:e}),". Enter it to verify the phone number for use with your account."]});function _(e){let{phoneNumber:n,onPhoneChange:t,error:a,nextStep:s,step:o,prevStep:g,setError:m,setCode:f,setValidatingCode:b,code:p,usePhoneNumberModal:y,validatingCode:x,codeInputRef:_,deletePhone:I,isVerifiedPhone:A,isSendingCode:N}=e,[E,k]=(0,i.useState)(!0);return 0===o?y?(0,r.jsx)(S,{error:a,isSendingCode:N,nextStep:s,onPhoneChange:t,phoneNumber:n}):(0,r.jsx)(v,{deletePhone:I,error:a,isSendingCode:N,isVerifiedPhone:A,nextStep:s,onPhoneChange:t,phoneNumber:n}):(0,r.jsxs)(d.Modal,{active:E,onClickOutside:()=>k(!1),children:[(0,r.jsx)(d.Body,{children:(0,r.jsx)(l.K,{align:"center",children:(0,r.jsxs)(l.K,{gap:6,justify:"center",style:{maxWidth:356},children:[(0,r.jsx)(c.x,{align:"center",as:"h3",size:24,style:{margin:0},weight:600,children:"Verification"}),(0,r.jsxs)(l.K,{align:"center",gap:5,children:[(0,r.jsx)(u.W,{authDispatch:null,back:()=>{m({code:"",message:"",canSelfVerify:!1}),f(""),b(!1),g()},code:p,codeFontSize:"16",descriptionText:j,error:a,isChromeStyle:!0,phoneNumber:n,ref:_,setCode:f,setError:m,showActionButtons:!1,validating:x}),a.message?(0,r.jsx)(C.Z,{"data-testid":(0,h.C)("login","error-message"),children:a.message}):null]})]})})}),(0,r.jsxs)(d.Actions,{children:[(0,r.jsx)(d.Action,{onClick:()=>g(),type:"secondary",children:"Back"}),(0,r.jsx)(d.Action,{disabled:x,loading:x,onClick:()=>void s(),children:x?"Verifying":"Verify"})]})]})}var I=t(611648),A=t(495142),N=t(678991),E=t(66818),k=(0,i.memo)(function(e){let{usePhoneNumberModal:n=!0,onVerified:t}=e,[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(""),[h,g]=(0,i.useState)(!1),[m,f]=(0,i.useState)(!1),[b,v]=(0,i.useState)(""),[p,y]=(0,i.useState)(!1),[S,C]=(0,i.useState)(!1),j=(0,i.useRef)(""),k=(0,i.useRef)(null),{user:M}=(0,x.Z)(),[P,w]=(0,i.useState)(0),[B,L]=(0,i.useState)({message:"",code:"none"}),O=(0,N.G)(),D=(0,i.useCallback)(async()=>{try{await O.setUserProperties({phone_number:null}),await O.setChannel({channel:"sms",enabled:!1}),c(""),f(!1),E.Vy.success({text:"Phone number deleted."})}catch(e){L(e)}},[O]),V=(0,i.useCallback)(async()=>{0!==P||m||await O.getUserData().then(e=>{if((null==e?void 0:e.body)&&e.body.phone_number){let n=e.body.phone_number.toString(),t=n.length>6?n.startsWith("+")?(0,o.SR)(n).formatInternational():(0,o.SR)(n).formatNational():n;c(t),f(!0)}}).catch(e=>L(e))},[m,P,O]),G=(0,i.useCallback)(async()=>{var e;switch(P){case 0:{if(C(!0),!h){L({message:"Invalid phone number.",code:"none"});return}L({message:"",code:"none"});let n=`${I.$n}/verify-phone?${(0,a.stringify)({email:null==M?void 0:M.email,phone:l,country:d})}`,t=await (0,A.I)(n,{method:"POST"});if(t.error){C(!1);let n=null===(e=t.error.limit)||void 0===e?void 0:e.reset;if("rate_limited"===t.error.code&&n){let e=(0,s.Z)(1e3*n-Date.now(),{long:!0});L({message:`Too many requests - try again in ${e}.`,code:"none"})}else L({message:t.error.message,code:"none"});return}w(P+1),C(!1);break}case 1:if(4===b.length){y(!0);let e=`${I.$n}/verify-phone-code?${(0,a.stringify)({email:null==M?void 0:M.email,phone:l,country:d,code:b})}`,n=await (0,A.I)(e,{method:"POST"});if(n.error)y(!1),L({message:n.error.message||"An error occured while verifying this code. Please try again.",code:"none"}),setTimeout(()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.focus()},500);else{"function"==typeof t&&t(),y(!1),w(0),L({message:"",code:""}),f(!0);let e="SMS notifications enabled";O.preferenceSet&&(e=`${e} for you on this team`),O.setChannel({channel:"sms",enabled:!0}).then(()=>{E.Vy.success(`Phone number saved. ${e}`)}).catch(()=>{E.Vy.success({text:"Phone number saved."}),E.Vy.error("Error enabling SMS")})}}else L({message:"The code must be 4 digits long.",code:"none"})}},[b,h,t,d,l,O,P,null==M?void 0:M.email]);(0,i.useEffect)(()=>{4===b.length&&(3===j.current.length||0===j.current.length)&&G(),j.current=b},[b,G]),(0,i.useEffect)(()=>{n||V()},[n]);let T=(0,i.useCallback)(()=>{w(e=>0===e?e:e-1)},[]),R=(0,i.useCallback)((e,n,t)=>{L({message:"",code:""}),g(e),c(n),u(t.iso2)},[]);return(0,r.jsx)(_,{code:b,codeInputRef:k,deletePhone:D,error:B,isSendingCode:S,isVerifiedPhone:m,nextStep:G,onPhoneChange:R,phoneNumber:l,prevStep:T,setCode:v,setError:L,setValidatingCode:y,step:P,usePhoneNumberModal:n,validatingCode:p})})},99703:function(e,n,t){"use strict";var r=t(397458),a=t(496952),s=t(832191),i=t(14517),o=t(572009),l=t.n(o);n.Z=function(e){let{feedback:n,muted:t,size:o}=e;return(0,r.jsxs)("div",{className:l().betaBadge,children:[(0,r.jsx)(a.C,{className:(0,i.W)(t?l().betaBadgeMuted:null),size:o,variant:t?"gray-subtle":"pink",children:"Beta"}),n?(0,r.jsx)(s.z,{className:l().feedbackButton,onClick:()=>{document.dispatchEvent(new Event("show-feedback"))},size:"small",type:"tertiary",children:"Provide feedback"}):null]})}},184812:function(e,n,t){"use strict";t.d(n,{P:function(){return r},Y:function(){return a}});let r={PLACEHOLDER:"placeholder",INPUT:"input",LOADING_EMAIL:"loading-email",LOADING_GITHUB:"loading-github",LOADING_GITLAB:"loading-gitlab",LOADING_BITBUCKET:"loading-bitbucket",LOADING_SAML:"loading-saml",VERIFYING_EMAIL:"verifying",SUCCESS:"success",ERROR:"error",ACCOUNT_NEEDS_VERIFY_SMS:"account-needs-verify",SELF_SERVE_VERIFICATION:"self-serve-verification"},a=[r.LOADING_GITHUB,r.LOADING_GITLAB,r.LOADING_BITBUCKET,r.LOADING_SAML,r.LOADING_EMAIL]},245685:function(e,n,t){"use strict";t.d(n,{r:function(){return a}});var r=t(923390);let a=(0,r.H)('<path d="M3 6h18"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>')},572009:function(e){e.exports={betaBadge:"beta-badge_betaBadge__nn52_",betaBadgeMuted:"beta-badge_betaBadgeMuted__VXlGg",feedbackButton:"beta-badge_feedbackButton__Q8_1M"}}}]);