(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50851],{475689:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[teamSlug]/[project]/settings/environment-variables",function(){return n(522117)}])},610029:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(611648),r=n(495142);async function i(e,t,n){return(0,r.I)(`${(0,a.HJ)("v5")}/${encodeURIComponent(e)}${t?"?teamId="+t:""}`,{method:"PATCH",body:JSON.stringify(n),throwOnHTTPError:!0})}},476385:function(e,t,n){"use strict";n.d(t,{$:function(){return r}});var a=n(652983);function r(e,t){let[n,r]=(0,a.useState)(e),[i,s]=function(e,t){let[n,r]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let n=setTimeout(()=>{r(e)},t);return()=>clearTimeout(n)},[e,r,t]),[n,r]}(n,t);return[i,r,{currentValue:n,setValueImmediate:(0,a.useCallback)(e=>{r(e),s(e)},[r,s])}]}},522117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eS}});var a=n(397458),r=n(652983),i=n(353729),s=n(446118),l=n(68839),d=n(9055),o=n(75883),c=n(283900),u=n(905839),v=n(101036),h=n(850240),m=n(760093),x=n(277346),j=n(306054),p=n(921690),f=n(66818),g=n(610029),y=n(761891),S=n(927628),E=n(881441),b=n(135635);function _(){let{project:e}=(0,s.useRouter)().query,{data:t,mutate:n}=(0,S.PY)(e),{team:i,isReady:o}=(0,b.t7)(),{mutate:c}=(0,E.Z)(e),_=(0,f.e1)(),{can:V,isLoading:w}=(0,y.ZP)(),P=V(y.aU.Update,y._z.Project),[k,C]=(0,r.useState)(!1),[T,Z]=(0,r.useState)(null),I=(0,r.useCallback)(async()=>{if(o&&t){C(!0),Z(null);try{await (0,g.Z)(e,null==i?void 0:i.id,{autoExposeSystemEnvs:!t.autoExposeSystemEnvs}),await Promise.all([n(),c()]),_.success("Updated System Environment Variable settings successfully.")}catch(e){Z((0,u.SC)(e))}finally{C(!1)}}},[e,i,o,t,n,c,_]);return(0,a.jsx)(x.D2,{disabled:w||!P,title:null,children:(0,a.jsxs)(l.K,{align:"start",gap:3,children:[(0,a.jsxs)(l.K,{align:"center",as:"label",direction:"row",gap:3,children:[k?(0,a.jsx)(v.$,{size:16}):o&&t?(0,a.jsx)(m.X,{checked:!!t.autoExposeSystemEnvs,name:"auto-expose-system-envs",onChange:()=>void I()}):(0,a.jsx)(h.O,{height:16,width:16}),(0,a.jsxs)(d.x,{as:"span",children:["Automatically expose"," ",(0,a.jsx)(p.r,{external:!0,href:"/docs/environment-variables#system-environment-variables",type:"highlight",children:"System Environment Variables"})]})]}),T?(0,a.jsx)(j.Z,{error:T}):null]})})}var V=n(605424),w=n(331049),P=n(875699),k=n(340574),C=n(897831),T=n(799297),Z=n(930316),I=n(280176),R=n(317779),L=n(596295),N=n(253576),A=n(566022),O=n(832191),z=n(465805),U=n(646912),D=n(131555),K=n(886847),$=n(672689),F=n(748088),H=n(502383),Y=n(609230),W=n(684624),G=n(699019),J=n.n(G),X=n(96149);function q(e){let{onAdd:t}=e,n=(0,r.useRef)(null),{project:i}=(0,s.useRouter)().query,d=(0,f.e1)(),{team:o,isTeam:c}=(0,b.t7)(),{user:v}=(0,Y.a)(),{data:h}=(0,S.PY)(i),{can:m,isLoading:g}=(0,y.ZP)(),E=m(y.aU.Create,y._z.ProjectEnvVars),[_,V]=(0,r.useState)(!1),[w,C]=(0,r.useState)(void 0),T=null==h?void 0:h.id,Z=(null==h?void 0:h.gitForkProtection)??!0,I=null==o?void 0:o.id,R=H.t.Encrypted,[L,N]=(0,r.useState)({value:"",edited:!1}),[A,G]=(0,r.useState)(""),[q,M]=(0,r.useState)(!0),[B,Q]=(0,r.useState)(!0),[ee,et]=(0,r.useState)(!0);(0,r.useEffect)(()=>{g||M(m(y.aU.Create,y._z.ProjectEnvVarsProduction))},[g,m]);let[en,ea]=(0,r.useState)(null),er=(0,r.useCallback)(()=>{N({value:"",edited:!1}),G(""),C(void 0)},[]),ei=async()=>{var e;V(!0);let a=en||void 0,r=[];q&&!a&&r.push(H.r.Production),B&&r.push(H.r.Preview),ee&&!a&&r.push(H.r.Development);try{await (0,$.ie)({projectId:T,key:L.value,value:A,target:r,teamId:I,type:R,gitBranch:a}),er(),ea(a),d.success("Added Environment Variable successfully."),t()}catch(e){C((0,u.SC)(e))}null===(e=n.current)||void 0===e||e.focus(),V(!1)};return(0,a.jsx)(z.Z,{"data-testid":(0,W.C)("env-variables","add-form"),onSubmit:ei,children:(0,a.jsxs)(x.D2,{disabled:g||!E,footerNote:E?null:(0,a.jsx)(k.ZP,{span:!0,style:{color:"var(--geist-foreground)"},children:"You need additional permissions to manage your project's environment variables."}),primaryAction:E?(0,a.jsx)(O.z,{loading:_,size:"small",typeName:"submit",children:"Add"}):null,secondaryAction:null,children:[(0,a.jsxs)(l.K,{direction:{sm:"column",md:"row",lg:"row"},gap:{sm:3,md:5,lg:5},children:[(0,a.jsxs)(l.K,{direction:"column",flex:"3",gap:3,children:[(0,a.jsx)(D.I,{"data-testid":(0,W.C)("env-variables","add-form","name-input"),id:"add-env-name",label:"Name",maxLength:256,onChange:e=>N({edited:!0,value:e.target.value}),placeholder:"EXAMPLE_NAME",ref:n,value:L.value}),(0,a.jsx)(l.K,{flex:"1",children:(0,a.jsx)(U.g,{className:J().plaintextValueTextarea,"data-testid":(0,W.C)("env-variables","add-form","value-input"),label:"Value",maxLength:65536,onChange:e=>G((0,F.v)(e.target.value)),placeholder:"YOUR_SECRET_VALUE_GOES_HERE",rows:4,spellCheck:"false",value:A,width:"100%"})})]}),(0,a.jsx)(l.K,{flex:"2",children:(0,a.jsx)(X.Z,{checkedDevelopment:ee,checkedPreview:B,checkedProduction:q,selectedGitBranch:en,setCheckedDevelopment:et,setCheckedPreview:Q,setCheckedProduction:M,setSelectedGitBranch:ea,type:R})})]}),(0,a.jsx)(P.L,{y:.5}),Z?null:(0,a.jsxs)(K.Z,{fill:!0,label:!1,type:"warning",variant:"contrast",children:["Because this Project has"," ",(0,a.jsx)(p.r,{href:`/${c?null==o?void 0:o.slug:null==v?void 0:v.username}/${i}/settings/security`,variant:"blend",children:"Git Fork Protection"})," ","disabled, Environment Variables are exposed to Git forks."]}),w?(0,a.jsxs)(a.Fragment,{children:[" ",(0,a.jsx)(P.L,{y:1})," ",(0,a.jsx)(j.Z,{error:w})," "]}):null]})})}var M=n(384157),B=n(338859),Q=n(601679),ee=n(623762),et=n(164481),en=n(727455),ea=n(36012),er=n(136566),ei=n(557385),es=n(476385),el=n(951517),ed=n(525727),eo=n.n(ed);function ec(e){let{selectedEnvVars:t,dispatchSelectedEnvVar:n,teamId:r,hideProductionEnvs:i,excludeProjectId:s}=e,{account:d}=(0,ei.Z)();return(0,a.jsx)(l.K,{direction:"column",gap:4,children:(0,a.jsx)(er.Z,{value:"Search Shared Environment Variables",children:(0,a.jsx)(ea.E,{data:[d],fallback:(0,a.jsx)(h.O,{height:40,width:"100%"}),children:(0,a.jsxs)(l.K,{flex:1,gap:4,children:[(0,a.jsx)(ev,{dispatchSelectedEnvVar:n,excludeProjectId:s,hideProductionEnvs:i,selectedEnvVars:t,teamId:r}),!!t.length&&(0,a.jsx)(l.K,{flex:1,children:t.map(e=>(0,a.jsx)(eu,{dispatchSelectedEnvVar:n,envVar:e},e.id))})]})})})})}function eu(e){let{envVar:t,dispatchSelectedEnvVar:n}=e;return(0,a.jsx)(x.JH,{actions:(0,a.jsx)(O.z,{"aria-label":"remove row",onClick:()=>{n({type:"remove",payload:t})},style:{boxShadow:"none"},svgOnly:!0,type:"secondary",children:(0,a.jsx)(B.S,{size:16})}),children:(0,a.jsx)(x.Sn,{description:Array.isArray(t.target)?t.target.map(el.Z).join(", "):t.target,title:(0,a.jsx)("span",{style:{fontFamily:"var(--font-mono)"},children:t.key})})},t.id)}function ev(e){let{teamId:t,selectedEnvVars:n,hideProductionEnvs:i,dispatchSelectedEnvVar:s,excludeProjectId:l}=e,[d,o]=(0,r.useState)(""),[c,u]=(0,es.$)("",200),[v,m]=(0,en.FC)({teamId:t,excludeProjectId:l,excludeIds:n.map(e=>e.id)},{limit:20,latestDeployments:0,search:c},{},!1,!0),{envVars:x}=m;(0,r.useEffect)(()=>{u(d)},[d,u]);let j=(0,r.useMemo)(()=>x.filter(e=>!(i&&e.key.includes("PRODUCTION"))),[x,i]);return void 0===v.data?(0,a.jsx)(h.O,{height:40,width:"100%"}):(0,a.jsx)(ee._,{ListFooterComponent:(0,a.jsx)(et.Z,{swr:m}),OptionComponent:eh,classNames:{list:eo().list},hideSelectedItems:!0,items:j,onChange:e=>{let t=j.find(t=>null==e?void 0:e.includes(t.id))??null;t&&s({type:"add",payload:t})},placeholderText:"Search Shared Environment Variables",search:d,selectedItems:n,setSearch:o})}function eh(e){let{item:t}=e;return(0,a.jsxs)(Q.Z.Option,{className:eo().envVarOption,ignoreDefaultHeight:!0,value:`${t.key},${t.id}`,children:[(0,a.jsx)(d.x,{className:eo().envVarName,children:t.key}),(0,a.jsx)("div",{className:eo().envVarTarget,children:Array.isArray(t.target)?t.target.map(el.Z).join(", "):t.target})]})}var em=n(234113);function ex(e,t){switch(t.type){case"add":return new Set([...e,t.payload]);case"remove":return new Set([...e].filter(e=>e.id!==t.payload.id));case"reset":return new Set([]);default:return e}}var ej=n(353659);function ep(e){let{teamId:t,onLink:n}=e,{project:i}=(0,s.useRouter)().query,{data:d}=(0,S.PY)(i),o=(0,f.e1)(),[c,v]=(0,r.useState)(!1),[h,m]=(0,r.useReducer)(ex,new Set([])),p=(0,r.useMemo)(()=>[...h],[h]),{can:g,isLoading:E}=(0,y.ZP)({teamId:t}),b=g(y.aU.Update,y._z.SharedEnvVars),_=g(y.aU.Update,y._z.SharedEnvVarsProduction),[V,w]=(0,r.useState)(void 0),P=(0,r.useCallback)(()=>{m({type:"reset"}),w(void 0)},[]),k=(0,r.useCallback)(async()=>{v(!0);try{if(!(null==d?void 0:d.id))throw Error("Project not found");await (0,em.uD)({envVars:p,projectId:d.id,teamId:t}),P(),o.success("Linked environment variables successfully."),null==n||n()}catch(e){w((0,u.SC)(e))}v(!1)},[null==d?void 0:d.id,p,t,P,o,n]);return(0,a.jsx)(z.Z,{onSubmit:()=>void k(),children:(0,a.jsx)(x.D2,{disabled:E||!b,footerNote:null,footerSeparator:!1,primaryAction:(0,a.jsx)(O.z,{loading:c,size:"small",typeName:"submit",children:"Link"}),secondaryAction:null,title:null,children:(0,a.jsxs)(l.K,{gap:4,children:[(0,a.jsx)(ec,{dispatchSelectedEnvVar:m,excludeProjectId:null==d?void 0:d.id,hideProductionEnvs:!_,selectedEnvVars:p,teamId:t}),(0,a.jsx)(ej.V,{}),V?(0,a.jsx)(j.Z,{error:V}):null]})})})}var ef=n(662778);function eg(e){var t;let{mutateProjectEnvsData:n,mutateSharedEnvVarData:i}=e,s=(0,r.useRef)(null),{team:o}=(0,b.t7)(),[c,u]=(0,r.useState)("create-new"),{value:v,isReady:h}=(0,I.RW)(),{value:m,isReady:x}=(0,M.We)(),j=!h||!v||!(null==o?void 0:o.id),p=(0,N.useTransition)(!j,{from:{height:"0px"},enter:{height:(null===(t=s.current)||void 0===t?void 0:t.offsetHeight)||"40px"},leave:{height:"0px"}});return(0,a.jsxs)(l.K,{gap:4,children:[p((e,t)=>t?(0,a.jsx)(N.animated.div,{style:{overflow:"hidden",width:"100%",...e},children:(0,a.jsx)(A.m,{ref:s,selected:c,setSelected:u,tabs:[{title:"Create new",value:"create-new"},{title:(0,a.jsx)(l.K,{align:"center",direction:"row",gap:2,children:(0,a.jsx)(d.x,{as:"div",size:14,children:"Link Shared Environment Variables"})}),value:"link-tev"}]})}):null),"create-new"===c&&(x&&m?(0,a.jsx)(ef.xJ,{onSave:()=>void n(),teamId:null==o?void 0:o.id}):(0,a.jsx)(q,{onAdd:()=>void n()})),!j&&"link-tev"===c&&(0,a.jsx)(ep,{onLink:()=>void i(),teamId:o.id})]})}var ey=n(248388),eS=(0,C.Z)(function(){let{value:e,isReady:t}=(0,I.RW)(),{project:n}=(0,s.useRouter)().query,{cache:u}=(0,i.kY)(),{data:v,mutate:h}=(0,T.Z)(n,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1}),{data:m}=(0,S.PY)(n),x=null==m?void 0:m.id,j=(0,c._j)(x,h),{data:f,mutate:g}=(0,Z.s)(),{can:E,isLoading:C}=(0,y.ZP)(),N=E(y.aU.Read,y._z.ProjectEnvVars),A=E(y.aU.Read,y._z.ProjectEnvVarsProduction),O=E(y.aU.Read,y._z.Secrets),[z,U]=(0,r.useState)(""),[D,K]=(0,r.useState)("all-environments"),[$,F]=(0,r.useState)("createdAt"),{team:H}=(0,b.t7)(),{decryptEnvVar:Y}=(0,ey.Q)((0,T.W)(n,null==H?void 0:H.id),h,{projectName:n,teamId:null==H?void 0:H.id}),W=(0,L.w)(null==v?void 0:v.envs,z,D,$)(),{data:G,isLoading:J,mutate:X}=(0,en.jT)((null==H?void 0:H.id)??"",x),q=(0,en.A)({teamId:(null==H?void 0:H.id)??"",projectId:x});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.G,{title:`${n||""} – Environment Variables`,titlePostfix:!0}),(0,a.jsxs)("div",{id:"environment-variables-fieldset",children:[(0,a.jsx)(k.ZP,{Component:"h2",h3:!0,noMargin:!0,children:"Environment Variables"}),(0,a.jsx)(k.ZP,{preset:"body-2",children:(0,a.jsxs)(a.Fragment,{children:["In order to provide your Deployment with Environment Variables at Build and Runtime, you may enter them right here, for the Environment of your choice."," ",(0,a.jsx)(p.r,{external:!0,href:"/docs/environment-variables",variant:"highlight",children:"Learn more"}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"A new Deployment is required for your changes to take effect."]})}),(0,a.jsx)(P.L,{}),(0,a.jsx)("div",{className:"env-variables-form",children:(0,a.jsx)(eg,{mutateProjectEnvsData:h,mutateSharedEnvVarData:X})}),(0,a.jsx)(P.L,{}),(0,a.jsx)(_,{}),(0,a.jsx)(w.Z,{margin:23}),(0,a.jsx)(V.Z,{disabled:!1,envTarget:D,envs:null==v?void 0:v.envs,search:z,setEnvTarget:K,setSearch:U,setSortTarget:F,sortTarget:$}),(0,a.jsx)(P.L,{y:.7}),(0,a.jsx)(c.ZP,{canReadProductionValues:A,disabled:C||!(N||A||O),envs:W,isLoading:C,onRemove:e=>j.open(e),onSave:e=>{var t;let a=(0,T.W)(n,null==H?void 0:H.id),r=null===(t=u.get(a))||void 0===t?void 0:t.data;if(r.envs.length>0){let t={...e,decrypted:!1},n=[...r.envs],a=n.findIndex(t=>t.id===e.id);n[a]=t,h({envs:n},!1),Y(t)}},onSecretAdd:()=>g(),onViewEnvironmentVariable:Y,search:z,secretsData:f,withEnvs:N,withSecrets:O}),j.modal]}),(null==H?void 0:H.id)!==void 0&&t&&e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P.L,{y:1.5}),(0,a.jsxs)(l.K,{gap:4,children:[(0,a.jsx)(l.K,{align:"center",direction:"row",gap:2,children:(0,a.jsx)(d.x,{as:"h2",lineHeight:24,size:20,children:"Shared Environment Variables"})}),(0,a.jsx)(R.V,{SWRCacheKey:q,envTarget:D,isLoading:J,mutateSharedEnvVarData:X,projectEnvs:W,projectId:x,search:z,setEnvTarget:K,setSearch:U,setSortTarget:F,sharedEnvs:(null==G?void 0:G.envs)??[],sortTarget:$,teamId:H.id,withFilters:!1})]})]}):null]})})},799297:function(e,t,n){"use strict";n.d(t,{W:function(){return c},Z:function(){return o}});var a=n(353729),r=n(495142),i=n(611648),s=n(539142),l=n(135635),d=n(761891);function o(e,t){let{isReady:n,team:i}=(0,l.t7)(),{can:s,isLoading:o}=(0,d.ZP)(),u=s(d.aU.Read,d._z.ProjectEnvVars),v=e&&n&&!o&&u;return(0,a.ZP)(()=>v?c(e,null==i?void 0:i.id):"",e=>(0,r.I)(e,{throwOnHTTPError:!0}),t)}function c(e,t){return`${(0,i.HJ)("v9")}/${encodeURIComponent(e)}/env${(0,s.c)({teamId:t})}`}},699019:function(e){e.exports={separator:"env-variables-add-form_separator__F57Zu",envVarTargetLabel:"env-variables-add-form_envVarTargetLabel__VapXi",stepTitle:"env-variables-add-form_stepTitle__ArV3w",disabled:"env-variables-add-form_disabled__4Q3ma",plaintextValueTextarea:"env-variables-add-form_plaintextValueTextarea__uSN_N"}},525727:function(e){e.exports={envVarOption:"link-tev-select_envVarOption__9o1OI",envVarName:"link-tev-select_envVarName__JPCX1",envVarTarget:"link-tev-select_envVarTarget__gFY56",list:"link-tev-select_list__IlQp4"}}},function(e){e.O(0,[4299,62308,24148,98586,85394,38419,59085,49162,81797,21930,10599,97831,83900,11342,49774,92888,40179],function(){return e(e.s=475689)}),_N_E=e.O()}]);