"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[88661],{108470:function(e,t,n){function o(e){let t=new URLSearchParams;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.append(n,e[n]??"");return t.toString()}function r(e){let t=new URLSearchParams(e),n={};for(let[e,o]of t.entries())n[e]=o||void 0;return n}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=",o=[];for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];if(Array.isArray(r))for(let e of r)o.push(`${encodeURIComponent(t)}${n}${encodeURIComponent(e.toString())}`);else void 0!==r&&o.push(`${encodeURIComponent(t)}${n}${encodeURIComponent(r.toString())}`)}return o.join(t)}n.d(t,{Jx:function(){return r},Pz:function(){return i},cv:function(){return o}})},137925:function(e,t,n){n.d(t,{D:function(){return a}});var o=n(595376),r=n(108470),i=n(495142),l=n(611648);async function a(e,t){var n;let{mode:a}=t,u=o.daumtools.userAgent(),c=null==u?void 0:null===(n=u.browser)||void 0===n?void 0:n.name,s=`Website${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,g=(0,r.Pz)({mode:a});return(0,i.I)(`${l.OK}?${g}`,{method:"POST",body:JSON.stringify({email:e,tokenName:s}),throwOnHTTPError:!0})}},905600:function(e,t,n){n.d(t,{Z:function(){return a}});var o=n(108470),r=n(495142),i=n(919865),l=n(611648);async function a(e){let{email:t,token:n,ssoToken:a}=e,u=(0,o.Pz)({email:t,token:n,t:Date.now(),...a&&{ssoToken:a}});try{return await (0,r.I)(`${l.OK}/verify?${u}`,{throwOnHTTPError:!0}),delete globalThis.__loggedIn,!0}catch(e){if((0,i.f)(e)&&403===e.status)throw e;return!1}}},919865:function(e,t,n){n.d(t,{f:function(){return r}});var o=n(500057);let r=e=>(0,o.x)(e)&&"code"in e},682672:function(e,t,n){n.d(t,{Z:function(){return o}});function o(e){return new Promise(t=>{setTimeout(t,e)})}},184812:function(e,t,n){n.d(t,{P:function(){return o},Y:function(){return r}});let o={PLACEHOLDER:"placeholder",INPUT:"input",LOADING_EMAIL:"loading-email",LOADING_GITHUB:"loading-github",LOADING_GITLAB:"loading-gitlab",LOADING_BITBUCKET:"loading-bitbucket",LOADING_SAML:"loading-saml",VERIFYING_EMAIL:"verifying",SUCCESS:"success",ERROR:"error",ACCOUNT_NEEDS_VERIFY_SMS:"account-needs-verify",SELF_SERVE_VERIFICATION:"self-serve-verification"},r=[o.LOADING_GITHUB,o.LOADING_GITLAB,o.LOADING_BITBUCKET,o.LOADING_SAML,o.LOADING_EMAIL]},88661:function(e,t,n){n.d(t,{PM:function(){return C.P},YN:function(){return C.Y},aC:function(){return T}});var o=n(652983),r=n(369487),i=n(905839),l=n(358971),a=n(578903),u=n(490720),c=n.n(u),s=n(291033),g=n(137925),d=n(905600),f=n(682672),h=n(523426),p=n(539701),S=n(539142),E=n(600929),R=n(387649),I=n(800521),P=n(1367),v=n(609230),w=n(611648),m=n(486499),L=n(919865),O=n(927201),A=n(495142),N=n(572882),C=n(184812);function b(e,t){return{...e,...t}}let _=()=>{},y=()=>`${window.location.origin}/oauth/git`,T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"login",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,u]=(0,o.useReducer)(b,{loginState:C.P.PLACEHOLDER,loginError:null,isLoading:!0,...t.defaultState}),T=(0,o.useRef)(null),$=(0,l.useRouter)(),k=(0,a.useRouter)(),G=$||k,D=(0,a.useSearchParams)(),x=(0,a.usePathname)(),M=(0,h.Z)(null==D?void 0:D.get("next")),H=(0,o.useRef)(_),B=(0,o.useRef)(t);B.current=t;let{data:F}=(0,v.a)(),Y=null==F?void 0:F.user;(0,o.useEffect)(()=>()=>{T.current&&T.current.close(),T.current=null},[]),(0,o.useEffect)(()=>{let e=n.loginState===C.P.PLACEHOLDER||C.Y.includes(n.loginState);n.isLoading&&!e&&u({isLoading:e})},[n.loginState,n.isLoading]),(0,o.useEffect)(()=>{if(x&&(null==D?void 0:D.get("next"))&&!(0,h.Z)(D.get("next"))){let e=new URLSearchParams(D);e.delete("next"),G.replace(`${x}?${e.toString()}`,void 0,{shallow:!0})}},[x,D,G]),(0,o.useEffect)(()=>{if(!T.current&&(!("isReady"in G)||G.isReady)){if((null==D?void 0:D.get("loginType"))==="saml"&&"1"===D.get("confirmed")){u({loginState:C.P.LOADING_SAML});let e=D.get("teamSlug"),t=new URLSearchParams(D);e&&!M&&t.set("next",`/${e}`);let n=`${y()}?${t.toString()}`;G.push(n);return}if((null==D?void 0:D.get("origin"))==="saml"&&"/login"===window.location.pathname){u({loginState:C.P.LOADING_SAML}),G.push(`/teams/connect?${D.toString()}`);return}u({loginState:C.P.INPUT})}},[D,G,M]),(0,o.useEffect)(()=>{let e=null==D?void 0:D.get("loginError");e&&u({loginState:C.P.ERROR,loginError:(0,m.j)(e)})},[D]);let W=(0,o.useCallback)(async o=>{var r,i,l,a,c;if(!T.current||o.source!==T.current.popup||"object"!=typeof o.data||!o.data)return;let{source:g,close:d,success:f,next:h,...p}=o.data;if("vercel-verify-auth"!==g)return;let S=null===(i=T.current)||void 0===i?void 0:null===(r=i.popup)||void 0===r?void 0:r.location.search,E=S?new URLSearchParams(S):null;if(d){T.current.close(!0),T.current=null,E&&E.has("origin")&&"saml"===E.get("origin")&&G.push(`/teams/connect?${E.toString()}`);return}if(p.loginError&&(T.current.close(!0),T.current=null),u(p),f){let o=E?E.get("next"):null,r=o?decodeURIComponent(o):null;if(null===(l=T.current)||void 0===l||l.close(!0),T.current=null,"signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}if(delete globalThis.__loggedIn,await (0,P.Hu)(),B.current.onAuthenticated)B.current.onAuthenticated();else{let o=h||r||M||"signup"!==e&&"/dashboard";if(o){if("signup"===e&&o.startsWith("/turborepo"))try{let e=await (0,O.P)();e.user&&await U(e.user.email)}catch(e){console.error(e)}t.skipDefaultRedirectOnSignup||(window.location.href=o)}else["loading-github","loading-gitlab","loading-bitbucket"].includes(n.loginState)&&await (0,R.x)({provider:n.loginState.split("-")[1],namespaceId:null}),window.location.href="/new"}}else null===(a=(c=B.current).onError)||void 0===a||a.call(c)},[e,M,t.skipDefaultRedirectOnSignup,n.loginState,G]);function V(n,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{next:i,callbackParams:l,...a}=r,c=y()+(0,S.c)({next:t.useRedirect?i??M:i,...l});"login"===e?s.co.track(s.s6.LOGIN,{source:`${(0,E.F)(n)} login`}):s.co.track(s.s6.SIGN_UP);let g="saml"===n.toLowerCase()?w.fr:w.OK,d=`${g}${o}${(0,S.c)({mode:e,next:c,...a})}`;u({loginError:null}),t.useRedirect?(u({loginState:C.P[`LOADING_${n.toUpperCase()}`]}),window.location.href=d):(T.current=new p.Z({id:"vercel-login-popup",url:d,callbacks:{onOpen:()=>{u({loginState:C.P[`LOADING_${n.toUpperCase()}`]})},onAbort:()=>{T.current=null,u({loginState:C.P.INPUT})},onClose:()=>{T.current=null,u({loginState:C.P.INPUT})},onBlocked:()=>{T.current=null,u({loginState:C.P.ERROR,loginError:{code:null,message:`The popup to authenticate with ${(0,E.F)(n)} could not be opened.`}})}}}),T.current.open())}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};V(e,"github"===e?"/login-with-github":`/${e}/connect`,t)}return(0,o.useEffect)(()=>(window.addEventListener("message",W),()=>{window.removeEventListener("message",W)}),[W]),{saveInput:function(e,t){n.loginState===C.P.ERROR?u({[e]:t,loginError:null}):u({[e]:t})},cancelLogin:function(){if(H.current(),u({loginState:C.P.INPUT,loginError:null}),t.skipRouterRedirectOnCancel||!x)return;let e=new URLSearchParams;M&&e.set("next",M);let n=null==D?void 0:D.get("isRequestAccess");n&&e.set("isRequestAccess",n);let o=null==D?void 0:D.get("teamName");o&&e.set("teamName",o),G.replace(`${x}?${e.toString()}`)},loginWithEmail:async function(){var o;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{email:a,teamSlug:h}=n,p=!1;H.current(),H.current=()=>p=!0;try{u({loginState:C.P.LOADING_EMAIL,loginError:null});let n=await (0,g.D)(a,{mode:e});u({loginState:C.P.VERIFYING_EMAIL,email:a,securityCode:n.securityCode});for(;;){if(p)return;if(await (0,d.Z)({email:a,token:n.token,ssoToken:null===(o=l.callbackParams)||void 0===o?void 0:o.ssoToken}))break;await (0,f.Z)(2500)}if("signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}await (0,P.Hu)();let r=l.patchedSignupAccountName;"signup"===e&&r&&r.length>0&&await (0,I.E)(()=>(0,A.I)(w.zh,{method:"PATCH",body:{name:c()(r)}}));let i=(0,N.bR)(),S=l.next??M??(h?`/${h}`:null)??(i?`/${i}`:null)??(Y?`/${Y.username}`:"/dashboard");if(S){if("signup"===e&&S.startsWith("/turborepo")&&a)try{await U(a)}catch(e){console.error(e)}"signup"!==e||t.skipDefaultRedirectOnSignup||(S="/new?onboarding=true"),u({loginState:C.P.SUCCESS}),t.skipDefaultRedirectOnSignup||setTimeout(()=>{window.location.href=new URL(S,window.location.href).href},300);return}u({loginState:C.P.SUCCESS})}catch(e){if(p)return;(0,L.f)(e)&&(e.redirect||(null==e?void 0:e.code)===r.aU.ACCOUNT_NEEDS_VERIFY)?n.email&&u({loginState:C.P.ACCOUNT_NEEDS_VERIFY_SMS}):u({loginState:C.P.ERROR,loginError:(0,i.SC)(e)})}},loginWithSAML:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{teamSlug:o}=n;if(!o)return u({loginState:C.P.ERROR,loginError:{code:"",message:"Please enter a Team slug."}});V("saml","",{next:M||`/${o}`,...t,teamId:o,mode:e})},loginWithGitHub:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z("github",e)},loginWithGitLab:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z("gitlab",e)},loginWithBitbucket:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z("bitbucket",e)},loginWithGit:Z,state:n,dispatch:u,mode:e}};async function U(e){try{let t=await fetch("/api/turborepo-signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("An unexpected error. Please try again later.")}catch(e){console.error(e)}}}}]);